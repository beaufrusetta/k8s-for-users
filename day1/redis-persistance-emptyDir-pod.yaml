# Everything in this file is part of the same YAML document and 
# thusly the same Kubernetes resource definition.

apiVersion: v1    # Kubernetes API version
kind: Pod         # Document resource kind

metadata:         # Resource-level metadata

  name: redis-v2  # Name of the resource
  labels:         # Applying taxonomy allows other resources to 
                  # refer to this via selectors.
    app: redis    # Labels are in a <key>: <value> form.
    version: v2   # The version label is not special, though 
                  # it is common for use with deployment and 
                  # routing selection.

# Every resource has a spec. This is a free-form property map 
# and validated on the serverside to match known resource types.
spec:            

  # Define the set of volumes used by this pod.
  volumes:            
   - name: redis-data #  A volume for redis.
     emptyDir: {}     #  An empty directy on the host file system.

  # Each pod can contain multiple containers. They all share IPC, 
  # NET, and UTS namespaces. They are all on the same "virtual host."
  containers:    
   - name: redis
     image: redis:alpine
     volumeMounts:        # Mount the defined volume into the 
                          # container where the app writes data
      - mountPath: /data  #
        name: redis-data  #
     args:                # Equivallent to Docker command or CMD
      - "redis-server"    # Tell redis to persist data to disk
      - "--appendonly"    #
      - "yes"             #
